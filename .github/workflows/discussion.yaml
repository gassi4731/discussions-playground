name: DiscussionNotification

on:
  discussion:
    types: [created]

jobs:
  discussion:
    runs-on: ubuntu-22.04
    steps:
      - name: Read config.json
        id: config
        uses: jaywcjlove/github-action-read-file@main
        with:
          path: config.json
          
      - name: Get Discussion Action
        run: |
          echo "DISCUSSION_URL=${{ github.event.discussion.html_url }}" >> $GITHUB_ENV
          echo "DISCUSSION_TITLE=${{ github.event.discussion.title }}" >> $GITHUB_ENV
          echo "DISCUSSION_BODY=${{ github.event.discussion.body }}" >> $GITHUB_ENV
          echo "DISCUSSION_USER_NAME=${{ github.event.discussion.user.login }}" >> $GITHUB_ENV
      
      - name: Set ChannelId
        run: |
          echo "CHANNELID=${{ fromJson(steps.config.outputs.content)['instructorChannelId'] }}" >> $GITHUB_ENV
      
      - name: Send GitHub Action trigger data to Slack workflow
        id: slack
        uses: slackapi/slack-github-action@v1.16.0
        with:
          channel-id: "${{ $CHANNELID }}"
          payload: |
            {
              "attachments": [
                  {
                    "mrkdwn_in": ["text"],
                      "color": "#36a64f",
                      "pretext": "Optional pre-text that appears above the attachment block",
                      "author_name": "author_name",
                      "author_link": "http://flickr.com/bobby/",
                      "author_icon": "https://placeimg.com/16/16/people",
                      "title": "title",
                      "title_link": "https://api.slack.com/",
                      "text": "Optional `text` that appears within the attachment",
                      "fields": [
                          {
                              "title": "A field's title",
                              "value": "This field's value",
                              "short": false
                          },
                          {
                              "title": "A short field's title",
                              "value": "A short field's value",
                              "short": true
                          },
                          {
                              "title": "A second short field's title",
                              "value": "A second short field's value",
                              "short": true
                          }
                      ],
                      "thumb_url": "http://placekitten.com/g/200/200",
                      "footer": "footer",
                      "footer_icon": "https://platform.slack-edge.com/img/default_application_icon.png",
                      "ts": 123456789
                  }
              ]
            }
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
